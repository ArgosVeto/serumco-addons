<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <record id="prescription_argos_move_line_tree_view" model="ir.ui.view">
    <field name="name">prescription.argos.tree.view</field>
    <field name="model">stock.move.line</field>
    <field name="inherit_id" ref="stock.view_stock_move_line_detailed_operation_tree"/>
    <field name="mode">primary</field>
    <field name="priority" eval="100" />
    <field name="arch" type="xml">
      <field name="product_id" position="after">
        <field name="description_picking"/>
      </field>
    </field>
  </record>

  <record id="prescription_argos_form_view" model="ir.ui.view">
    <field name="name">prescription.argos.form.view</field>
    <field name="model">stock.picking</field>
    <field name="inherit_id" ref="stock.view_picking_form"/>
    <field name="mode">primary</field>
    <field name="priority" eval="100" />
    <field name="arch" type="xml">
      <field name="move_line_ids_without_package" position="replace">
        <field name="move_line_ids_without_package"
               attrs="{'readonly': ['|', '|', ('show_operations', '=', False), ('state', '=', 'cancel'), '&amp;', ('state', '=', 'done'), ('is_locked', '=', True)]}"
               context="{'tree_view_ref': 'argos_stock.prescription_argos_move_line_tree_view', 'default_picking_id': id, 'default_location_id': location_id, 'default_location_dest_id': location_dest_id, 'default_company_id': company_id}"/>
      </field>
      <xpath expr="//field[@name='move_ids_without_package']/tree" position="attributes" >
        <attribute name="create">false</attribute>
      </xpath>
      <xpath expr="//field[@name='move_ids_without_package']/tree//field[@name='description_picking']" position="attributes" >
        <attribute name="optional"></attribute>
      </xpath>
      <xpath expr="//field[@name='move_ids_without_package']/tree//field[@name='description_picking']" position="after" >
        <field name="administration_route_ids" widget="many2many_tags" />
      </xpath>
      <xpath expr="//header/button" position="before" >
        <button name="action_prescription_send" string="Send by Email" type="object"
                states="draft,waiting,confirmed,assigned,done"
                class="btn-primary"/>
      </xpath>
    </field>
  </record>

  <record id="action_arg_prescription" model="ir.actions.act_window">
    <field name="name">Prescriptions</field>
    <field name="res_model">stock.picking</field>
    <field name="type">ir.actions.act_window</field>
    <field name="view_mode">tree,kanban,form,calendar</field>
    <field name="domain">[('is_arg_prescription', '=', True)]</field>
    <field name="context">{
      'contact_display': 'partner_address',
      'default_company_id': allowed_company_ids[0],
      'default_is_arg_prescription': True,
      'form_view_ref': 'argos_stock.prescription_argos_form_view',
      }
    </field>
    <field name="help" type="html">
      <p>
        This action allows you to view patient prescriptions
      </p>
    </field>
  </record>

</odoo>
